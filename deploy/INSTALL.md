# tadata.ai Community Edition - Installation Guide

## Table of Contents

- [System Requirements](#system-requirements)
- [Installation Methods](#installation-methods)
  - [Quick Install](#quick-install)
  - [Manual Installation](#manual-installation)
- [Configuration](#configuration)
- [Starting and Stopping](#starting-and-stopping)
- [Troubleshooting](#troubleshooting)
- [Upgrading](#upgrading)
- [Backup and Restore](#backup-and-restore)
- [Uninstalling](#uninstalling)

---

## System Requirements

### Minimum Requirements

- **Operating System**: macOS 10.15+, Ubuntu 20.04+, Windows 10/11 with WSL2
- **Docker**: Docker Desktop 20.10+ or Docker Engine 20.10+
- **Docker Compose**: V2 (included with Docker Desktop)
- **RAM**: 4GB minimum, 8GB recommended
- **Disk Space**: 10GB minimum for images and data
- **CPU**: 2 cores minimum, 4+ recommended

### Prerequisites

1. **Docker Desktop** (macOS/Windows) or **Docker Engine** (Linux)
   - Download: https://www.docker.com/products/docker-desktop

2. **Anthropic API Key**
   - Sign up at: https://console.anthropic.com/
   - Create an API key with Claude access

---

## Installation Methods

### Quick Install

Run this single command to download and install tadata.ai:

```bash
curl -sSL https://raw.githubusercontent.com/secondwavetech/tadata-ce/main/deploy/install.sh | bash
```

This will:
- Clone the repository to `~/tadata-ce`
- Check prerequisites
- Guide you through configuration
- Start all services

### Manual Installation

For more control over the installation:

1. **Clone the repository**

```bash
git clone https://github.com/secondwavetech/tadata-ce.git
cd tadata-ce/deploy
```

2. **Check prerequisites**

```bash
./scripts/check-prerequisites.sh
```

3. **Configure environment**

```bash
cp .env.template .env
```

Edit `.env` and provide:
- `ANTHROPIC_API_KEY` - Your Anthropic API key

4. **Generate secrets**

```bash
./scripts/generate-secrets.sh
```

Then update `.env` with the generated secrets from `/tmp/tadata-secrets.env`

5. **Start services**

```bash
docker-compose pull
docker-compose up -d
```

6. **Verify installation**

```bash
./scripts/verify-installation.sh
```

7. **Access the application**

Open http://localhost:3000 in your browser

---

## Configuration

### Environment Variables

All configuration is managed through the `.env` file in the `deploy/` directory.

#### Required Variables

```bash
# Anthropic API Key (required)
ANTHROPIC_API_KEY=sk-ant-...

# Security (auto-generated, keep secure)
JWT_SECRET=<base64-encoded-32-bytes>
ENCRYPTION_KEY=<hex-encoded-32-bytes>

# Database
POSTGRES_PASSWORD=<auto-generated>
POSTGRES_TADATA_PASSWORD=<auto-generated>
```

#### Optional Variables

```bash
# Custom port mappings (if defaults conflict)
CLIENT_PORT=3000
SERVER_PORT=3001
FAAS_PORT=8080
FUNCTION_EXECUTOR_PORT=3002
DB_PORT=5432

# Image versions (default: latest)
CLIENT_IMAGE_TAG=latest
SERVER_IMAGE_TAG=latest
FAAS_IMAGE_TAG=latest
FUNCTION_EXECUTOR_IMAGE_TAG=latest
```

### Port Conflicts

If any default ports are already in use, modify them in `.env`:

```bash
# Example: Move client to port 8080
CLIENT_PORT=8080
```

Then restart:

```bash
docker-compose down
docker-compose up -d
```

---

## Starting and Stopping

### View Status

```bash
docker-compose ps
```

### View Logs

```bash
# All services
docker-compose logs -f

# Specific service
docker-compose logs -f server
```

### Stop Services

```bash
docker-compose stop
```

### Restart Services

```bash
docker-compose restart
```

### Stop and Remove Containers (preserves data)

```bash
docker-compose down
```

### Start Services Again

```bash
docker-compose up -d
```

---

## Troubleshooting

### Services Won't Start

**Check Docker is running:**

```bash
docker info
```

If this fails, start Docker Desktop or the Docker daemon.

**Check for port conflicts:**

```bash
docker-compose logs | grep -i "bind"
```

If you see port binding errors, change the conflicting ports in `.env`.

**Check available resources:**

Docker Desktop → Preferences → Resources

Ensure at least 4GB RAM is allocated.

### Database Connection Errors

**Check database container:**

```bash
docker-compose logs db
```

**Verify database credentials in `.env`:**

```bash
grep POSTGRES .env
```

**Restart the database:**

```bash
docker-compose restart db
```

### Server Health Check Fails

**Wait for startup:**

Services can take 30-60 seconds to fully start. Wait and check again.

**Check server logs:**

```bash
docker-compose logs server
```

**Verify all services are running:**

```bash
docker-compose ps
```

All services should show "Up" status.

### Cannot Access http://localhost:3000

**Check client container:**

```bash
docker-compose logs client
```

**Verify port mapping:**

```bash
docker ps | grep tadata-client
```

Look for `0.0.0.0:3000->80/tcp`

**Try the alternate URL:**

```bash
curl http://localhost:3000
```

### Images Won't Pull

**Check internet connection:**

```bash
docker pull ghcr.io/secondwavetech/tadata-server:latest
```

**Check Docker Hub/GHCR status:**

Visit https://www.githubstatus.com/

**Use specific image tag:**

In `.env`, specify a known working version:

```bash
SERVER_IMAGE_TAG=v1.0.0
```

### Memory or Performance Issues

**Check Docker resource usage:**

```bash
docker stats
```

**Increase Docker resources:**

Docker Desktop → Preferences → Resources → Increase Memory to 8GB

**Reduce service memory:**

Edit `docker-compose.yml` and add memory limits:

```yaml
services:
  server:
    mem_limit: 1g
```

---

## Upgrading

### To Latest Version

```bash
cd ~/tadata-ce/deploy

# Pull latest images
docker-compose pull

# Restart with new images
docker-compose up -d

# Check logs
docker-compose logs -f
```

### To Specific Version

Update `.env`:

```bash
CLIENT_IMAGE_TAG=v1.2.0
SERVER_IMAGE_TAG=v1.2.0
FAAS_IMAGE_TAG=v1.2.0
FUNCTION_EXECUTOR_IMAGE_TAG=v1.2.0
```

Then:

```bash
docker-compose pull
docker-compose up -d
```

### Update Installation Scripts

```bash
cd ~/tadata-ce
git pull origin main
cd deploy
```

---

## Backup and Restore

### Backup Data

**1. Stop services:**

```bash
docker-compose down
```

**2. Backup volumes:**

```bash
# Backup PostgreSQL data
docker run --rm \
  -v tadata-ce_postgres-data:/data \
  -v $(pwd):/backup \
  ubuntu tar czf /backup/postgres-backup-$(date +%Y%m%d).tar.gz /data

# Backup functions data
docker run --rm \
  -v tadata-ce_functions-data:/data \
  -v $(pwd):/backup \
  ubuntu tar czf /backup/functions-backup-$(date +%Y%m%d).tar.gz /data
```

**3. Backup configuration:**

```bash
cp .env .env.backup-$(date +%Y%m%d)
```

**4. Restart services:**

```bash
docker-compose up -d
```

### Restore Data

**1. Stop services:**

```bash
docker-compose down
```

**2. Restore volumes:**

```bash
# Restore PostgreSQL data
docker run --rm \
  -v tadata-ce_postgres-data:/data \
  -v $(pwd):/backup \
  ubuntu bash -c "cd /data && tar xzf /backup/postgres-backup-YYYYMMDD.tar.gz --strip 1"

# Restore functions data
docker run --rm \
  -v tadata-ce_functions-data:/data \
  -v $(pwd):/backup \
  ubuntu bash -c "cd /data && tar xzf /backup/functions-backup-YYYYMMDD.tar.gz --strip 1"
```

**3. Restore configuration:**

```bash
cp .env.backup-YYYYMMDD .env
```

**4. Start services:**

```bash
docker-compose up -d
```

---

## Uninstalling

### Complete Removal (including data)

```bash
cd ~/tadata-ce/deploy

# Stop and remove containers, networks, and volumes
docker-compose down -v

# Remove images (optional)
docker rmi ghcr.io/secondwavetech/tadata-client:latest
docker rmi ghcr.io/secondwavetech/tadata-server:latest
docker rmi ghcr.io/secondwavetech/tadata-faas:latest
docker rmi ghcr.io/secondwavetech/tadata-function-executor:latest

# Remove installation directory
cd ~
rm -rf tadata-ce
```

### Keep Data, Remove Application

```bash
cd ~/tadata-ce/deploy

# Stop and remove containers (keeps volumes)
docker-compose down

# Remove installation directory
cd ~
rm -rf tadata-ce
```

Data volumes will remain and can be restored if you reinstall.

---

## Getting Help

- **Documentation**: https://github.com/secondwavetech/tadata-ce
- **Issues**: https://github.com/secondwavetech/tadata-ce/issues
- **Discussions**: https://github.com/secondwavetech/tadata-ce/discussions

For production deployments or enterprise support, contact Second Wave.
